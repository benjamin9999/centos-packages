pkgbase=rqdq-libxslt
pkgname=(rqdq-libxslt rqdq-libxslt-devel rqdq-xslt-python)
pkgver=1.1.28
pkgrel=2
makedepends=('rqdq-libxml2-devel')
source=(ftp://xmlsoft.org/XSLT/libxslt-${pkgver}.tar.gz)
md5sums=('9667bf6f9310b957254fdcf6596600b7')

_prefix="opt/rqdq"

build() {
  cd "libxslt-${pkgver}"
  ./configure --prefix=/${_prefix} --with-python=/${_prefix}/bin/python --with-libxml-prefix=/${_prefix}
  make -j2
}

package() {
  depends=('zlib' 'rqdq-libxml2==2.9.2-2')
  install=libxslt.install

  cd "libxslt-${pkgver}"
  DESTDIR="${pkgdir}" make install
  mkdir -p "${pkgdir}/etc/ld.so.conf.d"
  echo "/${_prefix}/lib" > "${pkgdir}/etc/ld.so.conf.d/${pkgname}.conf"

  fpmx "$pkgname" \
    ${_prefix}/bin/xsltproc \
    ${_prefix}/lib/libexslt.so.0 \
    ${_prefix}/lib/libexslt.so.0.8.17 \
    ${_prefix}/lib/libxslt.so.1 \
    ${_prefix}/lib/libxslt.so.1.1.28 \
    ${_prefix}/share/man/man1
}

package_rqdq-libxslt-devel() {
  depends=("${pkgbase}==${pkgver}-${pkgrel}")

  cd "libxslt-${pkgver}"
  DESTDIR="${pkgdir}" make install

  fpmx "$pkgname" \
    ${_prefix}/bin/xslt-config \
    ${_prefix}/include/libexslt \
    ${_prefix}/include/libxslt \
    ${_prefix}/lib/libexslt.a \
    ${_prefix}/lib/libexslt.so \
    ${_prefix}/lib/libxslt.a \
    ${_prefix}/lib/libxslt.so \
    ${_prefix}/lib/pkgconfig \
    ${_prefix}/lib/xsltConf.sh \
    ${_prefix}/share/aclocal/libxslt.m4 \
    ${_prefix}/share/doc/libxslt-1.1.28 \
    ${_prefix}/share/man/man3
}

package_rqdq-libxslt-python() {
  depends=("${pkgbase}==${pkgver}-${pkgrel}" 'rqdq-python2-libs==2.7.10')

  cd "libxslt-${pkgver}"
  DESTDIR="${pkgdir}" make install

  fpmx "$pkgname" \
    ${_prefix}/lib/python2.7 \
    ${_prefix}/share/doc/libxslt-python-1.1.28
}
